# 更新日志

## [1.0.1] - 2025-11-23

### 🐛 重大 Bug 修复

#### 修复的严重问题
1. **会话类型判断错误**（最严重）
   - 问题：所有会话都被错误地记录为短休息，工作记录完全丢失
   - 原因：使用已更新的 timerStatus（idle）来判断会话类型
   - 修复：将 type 作为参数明确传入 completeSession

2. **时长计算错误**
   - 问题：休息会话显示 0 分钟
   - 原因：时长计算逻辑错误
   - 修复：直接使用 totalSeconds 计算

3. **统计数据不更新**
   - 问题：完成番茄钟后，所有统计数据都不变化
   - 原因：数据保存后未正确等待加载
   - 修复：使用 async/await 确保数据加载完成

4. **长短休息判断错误**
   - 问题：第 1 个番茄钟后就进入长休息
   - 原因：判断逻辑使用了错误的计数器
   - 修复：使用 todayStats.completed_count 正确判断

5. **自动控制功能不生效**
   - 问题：打开自动开始后无效
   - 原因：时序问题和状态判断错误
   - 修复：在数据加载完成后再执行自动开始

6. **UI 布局问题**
   - 问题：按钮贴着屏幕边缘
   - 修复：增加 padding 和支持换行

### ✅ 现在的正确行为

- ✅ 完成工作番茄钟后，统计数据实时更新
- ✅ 所有会话类型（工作/短休息/长休息）都正确保存
- ✅ 会话时长正确显示
- ✅ 长短休息判断正确（1,2,3 短休息，4 长休息）
- ✅ 自动开始功能完全正常
- ✅ 所有页面的统计数据同步更新

## [1.0.0] - 2025-11-23

### ✨ 首次发布

#### 核心功能
- ⏱️ 精确计时器（基于 timestamp，误差 < 1 秒）
- 🍅 经典番茄工作法（25 分钟工作 + 5 分钟短休息 + 15 分钟长休息）
- 📊 实时统计（今日完成数、专注时长、完成率）
- 🔔 通知提醒（工作/休息结束时）
- ⚙️ 灵活设置（自定义时长、目标、自动控制）
- 🌙 深色模式支持

#### 技术特性
- ✅ TypeScript 100% 类型安全
- ✅ 跨平台存储（SQLite + IndexedDB）
- ✅ 支持后台恢复
- ✅ 离线可用
- ✅ 数据持久化

#### UI/UX
- 🎨 番茄红主题色
- ✨ 流畅的动画效果
- 📱 响应式设计
- 🎯 简洁直观的界面

## 开发信息

- **技术栈：** Expo SDK 54 + React Native + TypeScript
- **状态管理：** Zustand
- **数据库：** SQLite (移动端) / IndexedDB (Web)
- **代码复用：** 60-70%（基于 remember-to-drink-water 项目）
